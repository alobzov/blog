---
layout: post
date: 2016-09-16
title:  Тонкости построения сетевых моделей в Python
description: |
    Что является основным инструментом, который использует руководитель при управлении проектом? Принято считать, что основным инструментом руководителя проекта является календарный план, в основе которого лежит сетевая модель работ по проекту. Однажды мне довелось реализовать сетевую модель работ на языке Python (код и описание <a href="https://github.com/alobzov/predict">здесь</a>). Ниже приведены уроки, извлеченные по результатам проделанной работы.
author: Алексей Лобзов
place: Москва, Россия
source: https://habr.com/ru/articles/310216/
---

Что является основным инструментом, который использует руководитель при управлении проектом? Принято считать, что основным инструментом руководителя проекта является календарный план, в основе которого лежит сетевая модель работ по проекту. Однажды мне довелось реализовать сетевую модель работ на языке Python (код и описание [здесь](https://github.com/alobzov/predict)). Ниже приведены уроки, извлеченные по результатам проделанной работы.

## Сначала создай работы, потом устанавливай связи

При построении сетевой модели часто возникает вопрос, в каком порядке создавать работы и устанавливать связи между ними? Наиболее очевидным является двухэтапный подход – сначала создаются все работы модели, затем между ними устанавливаются связи. Такой подход позволяет избежать ошибок типа *KeyError: '101'*, возникающих при параллельном выполнении этих двух операций, когда система пытается установить связь с работой, которая еще не была создана.

Конечно, суммарное время выполнения двух последовательных операций по созданию работ и установке связей между ними может быть оптимизировано за счет использования алгоритма, в котором эти операции выполняются параллельно. Однако даже на больших моделях с десятком тысяч работ последовательные алгоритмы работают достаточно быстро. Поэтому в условиях временных ограничений на реализацию проекта вполне можно обойтись классическим двухэтапным подходом.

## Пересчитывай модель после её построения

Стоит ли выполнять пересчет всякий раз, когда происходит установка связи между работами при построении сетевой модели? С одной стороны, постоянный пересчет позволяет держать модель в актуальном состоянии. С другой, пересчет увеличивает время ее построения.

Для сравнения были реализованы две функции:

1. **build_model_by_method()** – построение с пересчетом модели;
2. **build_model_by_assignment()** – построение без пересчета модели.

После чего проведено сравнение времени их выполнения на моделях из 100, 1000 и 10000 работ.

[network.py](https://github.com/alobzov/predict/blob/master/Тонкости%20построения%20сетевых%20моделей%20в%20Python/network.py)

Результаты сравнения:

```python
$ python network.py
Test for 100 activities:
build_model_by_method 1.7820062519999738
build_model_by_assignment 1.426311435999878
Test for 1000 activities
build_model_by_method 18.998158786999966
build_model_by_assignment 14.216093206999858
Test for 10000 activities
build_model_by_method 249.93449528199994
build_model_by_assignment 148.85600239800033
```

Как видно, чем больше работ, тем медленнее работает функция построения сетевой модели с использованием пересчета по сравнению с функцией, в которой пересчет не используется.

## Контролируй глубину рекурсии

Сетевая модель проекта состоит из работ и связей между ними. В отсутствии дополнительной информации о сети для ее пересчета используются рекурсивные алгоритмы. Такие алгоритмы состоят в последовательном проходе по работам сети и пересчете их параметров (например, длительности, дат начала и окончания). Чем больше работ в сети, тем больше глубина рекурсии.

Известно, что в Python по умолчанию установлено ограничение на глубину рекурсии – не больше 1000 рекурсивных вызовов. Для получения этого ограничения предназначен метод getrecursionlimit() модуля sys.

```python
>>> import sys
>>> sys.getrecursionlimit()
1000
```

При работе с большими сетями, число работ в которых измеряется десятками тысяч, обычной ситуацией является превышение глубины рекурсии и, как следствие, возникновение ошибки типа *RecursionError: maximum recursion depth exceeded in comparison*. Ошибка приводит к остановке построения либо пересчета модели и падению системы.

Чтобы предотвратить ошибку, построить и пересчитать большую сеть, необходимо увеличить ограничение на глубину рекурсии. И в этом нам поможет метод *setrecursionlimit()* модуля *sys*.

```python
>>> import sys
>>> sys.setrecursionlimit(10000)
>>> sys.getrecursionlimit()
10000
```

До какого значения требуется увеличить глубину рекурсии? Ответ на этот вопрос зависит от структуры сетевой модели. Если структура неизвестна или достаточно сложна, рекомендую устанавливать ограничение в значение, равное количеству работ в сети. Рекурсивный алгоритм проходится либо по всем либо по части работ. Поэтому глубина рекурсии не должна превысить количество работ в сети.

## И напоследок…

Управление проектами – это модно. Но модно еще не значит эффективно. На рынке существуют программные решения по пересчету сетевых моделей, такие как Microsoft Project. Однако алгоритмы, зашитые в них остаются доступными только вендерам соответствующего программного обеспечения.

Настоящая статья написана на основе опыта разработки открытого модуля по построению и пересчету сетевых моделей проектов. Я надеюсь, что приведенные в статье извлеченные уроки будут полезны читателю как с теоретической, так и с чисто практической точки зрения. Если настоящая статья вызовет интерес, то я поделюсь новыми знаниями, которые возникнут в дальнейшем, по мере развития модуля.

[Оригинальный текст](https://habr.com/ru/articles/310216/)
|
[Доклад по материалам статьи](https://moscowpython.ru/meetup/39/ispolzovanie-python-dlja-postroenija-setevyh-model/)